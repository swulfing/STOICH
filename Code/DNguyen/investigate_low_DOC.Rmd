---
title: "Investigate low DOC"
author: "David Nguyen"
date: '2022-04-20'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
# source("Code/masterDataVARIABLES.R")
setwd("C://Users//david//Documents//STOICH//STOICH.Aim1//Code/DNguyen")
#write.csv(ALL_CNP, "ALL_CNP.csv", row.names = FALSE)
ALL_CNP <- read.csv("ALL_CNP.csv")
```


```{r}
ALL_CNP %>% 
  ggplot() + 
  geom_jitter(aes(x = log(DOC), y = 0, col = ECO_TYPE), width = 0, alpha = 0.5) + 
  geom_vline(xintercept = -3)
```

DOC clusters our data into 2 groups. Most of the low DOC data are lakes with a few rivers scattered within the low DOC cluster.

```{r}
# get low DOC subset
low_DOC <- ALL_CNP %>% filter(log(DOC) < -3)
```

I'm just going to arbitrarily use log(DOC) = -3 as a threshold between the groups.

```{r}
# lakes with low DOC are all from the LAGOS data set
low_DOC %>% 
  filter(ECO_TYPE == "Lake") %>% 
  separate(SITE_ID, into = c("source", "source_id"), remove = FALSE) %>%
  pull(source) %>% unique()
```
All low DOC lakes are from the LAGOS data set.

Is this a systematic issue with all DOC measurements in the LAGOS data set?

```{r}
# is it all LAGOS lakes that have low DOC?
low_DOC %>% filter(ECO_TYPE == "Lake") %>% nrow() # number of low DOC lakes (all from LAGOS)
ALL_CNP %>% filter(str_detect(SITE_ID,"LAGOS") ) %>% nrow() # number of LAGOS lakes
```

Not all lakes in the LAGOS data set have super low DOC.

```{r}
ALL_CNP %>% 
  filter(str_detect(SITE_ID, "LAGOS")) %>%
  ggplot() + 
  geom_jitter(aes(x = log(DOC), y = 0, col = ECO_TYPE), width = 0, alpha = 0.5) + 
  geom_vline(xintercept = -3) +
  labs(title = "Only data from LAGOS database")

```

Hmm, if it was a unit error, shouldn't all data from the LAGOS database have this issue?

```{r}
# rivers with low DOC
# all from ECN T08
low_DOC %>% filter(ECO_TYPE == "River/Stream")
```

Only a few rivers have low DOC. They are all from the ECN source (dunno what that means)

# TO DO

Go back to original data and figure out what went wrong. I don't think I'm qualified to do this since I wasn't involved in the data collection/processing step. 
